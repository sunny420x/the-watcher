<html>
<head>
    <title>The Watcher - Network Scanner| Sunny420x</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        tr.hidden {
            display: none;
        }

        tr.unhidden {
            display: table-row;
        }
    </style>
</head>
<body>
    <div class="px-5 py-3 text-bg-dark"> 
        <h2>The Watcher - Network Scanner</h2> 
        <p>By Sunny420x</p> 
    </div>
    <script>
        let i = 0
        let range = "<%=query%>"
        let current = parseInt(range.split('.')[2])
        range = range.split('.')[0]+'.'+range.split('.')[1]+'.'

        const loadingSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="50" height="50" style="shape-rendering: auto; display: block; background: rgba(255, 255, 255, 0); margin: auto; margin-top: 100px;" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="164.93361431346415 56.97787143782138" r="35" stroke-width="10" stroke="#222222" fill="none" cy="50" cx="50">
        <animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
        </circle><g></g></g><!-- [ldio] generated by https://loading.io --></svg>`

        function run(range) {
            fetch(`/run/${range}`).then(res => {
                if(res.ok) {
                    return res.text()
                } else {
                    return "Error"
                }
            }).then(data => {
                document.getElementById('result').innerHTML = data
            })
        }

        function next() {
            if(current+1 == 256) {
                current = 0;
                range = range.split('.')[0] + '.' + (parseInt(range.split('.')[1]) + 1) + '.';
            }
            document.getElementById('result').innerHTML = loadingSvg
            run(range+(current+=1)); document.getElementById('query').value=range+current
            history.pushState(null, null, '/'+range+current);

        }

        function back() {
            if(current-1 == -1) {
                current = 256;
                range = range.split('.')[0] + '.' + (parseInt(range.split('.')[1]) - 1) + '.';
            }
            document.getElementById('result').innerHTML = loadingSvg
            run(range+(current-=1)); document.getElementById('query').value=range+current
            history.pushState(null, null, '/'+range+current);
        }

        function initField() {
            document.getElementById('result').innerHTML = loadingSvg
            
            document.getElementById('query').value=range+current
            run(range+current)
        }

        function search(value) {
            document.getElementById('result').innerHTML = "<br>Loading..."
            run(value); 
            range=value.split('.')[0]+'.'+value.split('.')[1]+'.'; 
            current=parseInt(value.split('.')[2])
            history.pushState(null, null, '/'+value);
        }

        function toggleFilter(option) {
            if(option == "hidden") {
                document.querySelectorAll('.hidden, .unhidden').forEach(row => {
                    row.classList.toggle('hidden');
                    row.classList.toggle('unhidden');
                });
            }
        }

        document.addEventListener("keydown", (event) => {
            if (event.defaultPrevented) {
                return;
            }

            switch (event.key) {
                case "ArrowLeft":
                back()
                break;
                case "ArrowRight":
                next()
                break;
                default:
                return;
            }

        event.preventDefault();
        }, true);

    </script>
    <div class="container my-4">
        <div class="row">
            <div class="col">
                <input type="text" id="query" onchange="search(this.value)" class="form-control">
            </div>
            <div class="col-auto">
                <button onclick="back()" class="btn btn-primary">Previous</button>
            </div>
            <div class="col-auto">
                <button onclick="next()" class="btn btn-primary">Next</button>
            </div>
        </div>
        <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" value="" id="hiddenFilter" onchange="toggleFilter('hidden')">
            <label class="form-check-label" for="hiddenFilter">
                Show unuseful host.
            </label>
        </div>
        <div id="result">
        </div>
    </div>
    <script>
        initField()
    </script>
</body>
</html>
